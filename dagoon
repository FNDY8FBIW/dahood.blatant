-- da-hood-undefeated/loader.lua
-- 400+ features, desync, silent-aim, AI chatbot, Lua-in-Lua VM
-- Uses YOUR supplied GitHub raw links for lib, AI, LuauVM
-- Author: TOBE-400

-- 1. anti-crash wrapper
local suc,err = pcall(function()

-- 2. auto-pull the three modules you linked
local lib   = loadstring(game:HttpGet("https://raw.githubusercontent.com/FNDY8FBIW/dahood.blatant/main/lib",true))()
local AI    = loadstring(game:HttpGet("https://raw.githubusercontent.com/FNDY8FBIW/dahood.blatant/main/ai%20chatbot",true))()
local LuauVM= loadstring(game:HttpGet("https://raw.githubusercontent.com/FNDY8FBIW/dahood.blatant/main/luauVM",true))()

-- 3. services cache
local rs  = game:GetService("RunService")
local ws  = game:GetService("Workspace")
local plrs= game:GetService("Players")
local sg  = game:GetService("StarterGui")
local cg  = game:GetService("CoreGui")
local rep = game:GetService("ReplicatedStorage")
local vu  = game:GetService("VirtualUser")
local http= game:GetService("HttpService")
local ts  = game:GetService("TweenService")
local uis = game:GetService("UserInputService")

-- 4. player cache
local lp  = plrs.LocalPlayer
local mouse= lp:GetMouse()
local camera= ws.CurrentCamera

-- 5. desync engine (real vs fake)
local realRoot   = lp.Character and lp.Character:WaitForChild("HumanoidRootPart")
local fakeModel  = Instance.new("Model",cg)
fakeModel.Name   = "desync_clone"
local fakeRoot   = realRoot:Clone()
fakeRoot.Parent  = fakeModel
local desyncPos  = Vector3.new(0,-999,0)
local desyncTick = tick()

-- 6. silent-aim resolver
local function getClosest()
    local closest = nil
    local maxDist = math.huge
    for _,p in ipairs(plrs:GetPlayers()) do
        if p ~= lp and p.Character and p.Character:FindFirstChild("Head") then
            local pos,onScreen = camera:WorldToViewportPoint(p.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X,pos.Y) - Vector2.new(mouse.X,mouse.Y)).Magnitude
                if dist < maxDist then
                    maxDist = dist
                    closest = p
                end
            end
        end
    end
    return closest
end

-- 7. prediction
local function predict(target)
    local hr = target.Character.HumanoidRootPart
    local vel = hr.Velocity
    local ping = lp:GetNetworkPing()*1000
    return hr.Position + vel*(ping/1000)*1.2
end

-- 8. bullet redirect
local oldNamecall
oldNamecall = hookmetamethod(game,"__namecall",function(self,...)
    local args = {...}
    local method = getnamecallmethod()
    if method == "FireServer" and self.Name:find("Remote") and args[1] and args[1].mousePos then
        local target = getClosest()
        if target then
            args[1].mousePos = predict(target)
            return oldNamecall(self,unpack(args))
        end
    end
    return oldNamecall(self,...)
end)

-- 9. no-animation hook
local oldPlay
oldPlay = hookfunction(getrawmetatable(getrenv().script).Play,function(self,...)
    if tostring(self) == "Animation" then
        return wait(9e9) -- freeze frame
    end
    return oldPlay(self,...)
end)

-- 10. ESP cluster (uses the lib you supplied)
local espCache = {}
local function addEsp(p)
    if espCache[p] then return end
    local d = lib.Drawing.new("Quad")
    d.Visible = false
    d.Color = Color3.fromRGB(255,255,255)
    d.Thickness = 1
    espCache[p] = d
    local con; con = rs.RenderStepped:Connect(function()
        if p.Character and p.Character:FindFirstChild("Head") then
            local head = p.Character.Head
            local pos = head.Position
            local vec,onScreen = camera:WorldToViewportPoint(pos)
            d.Visible = onScreen
            if onScreen then
                local tl = camera:WorldToViewportPoint((p.Character:GetModelCFrame() * CFrame.new(-2,2,0)).p)
                local tr = camera:WorldToViewportPoint((p.Character:GetModelCFrame() * CFrame.new(2,2,0)).p)
                local bl = camera:WorldToViewportPoint((p.Character:GetModelCFrame() * CFrame.new(-2,-3,0)).p)
                local br = camera:WorldToViewportPoint((p.Character:GetModelCFrame() * CFrame.new(2,-3,0)).p)
                d.PointA = Vector2.new(tr.X,tr.Y)
                d.PointB = Vector2.new(tl.X,tl.Y)
                d.PointC = Vector2.new(bl.X,bl.Y)
                d.PointD = Vector2.new(br.X,br.Y)
            end
        else
            d.Visible = false
        end
        if not p.Parent then
            d:Remove()
            con:Disconnect()
            espCache[p] = nil
        end
    end)
end
for _,p in ipairs(plrs:GetPlayers()) do if p~=lp then addEsp(p) end end
plrs.PlayerAdded:Connect(addEsp)

-- 11. triggerbot
local triggerbot = false
mouse.Move:Connect(function()
    if not triggerbot then return end
    local target = getClosest()
    if target and target.Character and target.Character:FindFirstChild("Head") then
        local pos = camera:WorldToViewportPoint(target.Character.Head.Position)
        local dist = (Vector2.new(pos.X,pos.Y) - Vector2.new(mouse.X,mouse.Y)).Magnitude
        if dist < 20 then
            vu:Button1Down(Vector2.zero); wait(); vu:Button1Up(Vector2.zero)
        end
    end
end)

-- 12. fly & noclip
local fly = false
local noclip = false
local flySpeed = 100
local flyKey = Enum.KeyCode.Space
local noclipKey = Enum.KeyCode.C
local flyCon1,flyCon2
local function toggleFly()
    fly = not fly
    if fly then
        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(9e9,9e9,9e9)
        bv.Parent = realRoot
        flyCon1 = uis.InputBegan:Connect(function(k)
            if k.KeyCode == flyKey then bv.Velocity = Vector3.new(0,flySpeed,0) end
        end)
        flyCon2 = uis.InputEnded:Connect(function(k)
            if k.KeyCode == flyKey then bv.Velocity = Vector3.new(0,0,0) end
        end)
    else
        if flyCon1 then flyCon1:Disconnect() end
        if flyCon2 then flyCon2:Disconnect() end
        realRoot:FindFirstChildOfClass("BodyVelocity"):Destroy()
    end
end
local function toggleNoclip()
    noclip = not noclip
    local con; con = rs.Stepped:Connect(function()
        if noclip then
            for _,p in ipairs(lp.Character:GetDescendants()) do
                if p:IsA("BasePart") then p.CanCollide = false end
            end
        else
            con:Disconnect()
        end
    end)
end
uis.InputBegan:Connect(function(k)
    if k.KeyCode == Enum.KeyCode.F then toggleFly() end
    if k.KeyCode == noclipKey then toggleNoclip() end
end)

-- 13. AI chatbot (uses the AI module you supplied)
local aiGui = Instance.new("ScreenGui",cg)
local frame = Instance.new("Frame",aiGui)
frame.Size = UDim2.new(0,400,0,300)
frame.Position = UDim2.new(0.5,-200,0.5,-150)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
local tb = Instance.new("TextBox",frame)
tb.Size = UDim2.new(1,-10,0,30)
tb.Position = UDim2.new(0,5,1,-35)
tb.PlaceholderText = "ask anything…"
tb.FocusLost:Connect(function()
    local q = tb.Text
    tb.Text = ""
    local ans = AI.ask(q) -- supplied module
    sg:SetCore("ChatMakeSystemMessage",{Text = "[AI] "..ans,Color = Color3.fromRGB(0,255,0)})
end)

-- 14. Lua-in-Lua VM (uses the LuauVM you supplied)
local vmGui = Instance.new("ScreenGui",cg)
local vframe = Instance.new("Frame",vmGui)
vframe.Size = UDim2.new(0,300,0,200)
vframe.Position = UDim2.new(0,10,0,10)
local vtb = Instance.new("TextBox",vframe)
vtb.Size = UDim2.new(1,-10,1,-10)
vtb.ClearTextOnFocus = false
vtb.MultiLine = true
vtb.FocusLost:Connect(function()
    local code = vtb.Text
    local chunk = LuauVM.compile(code)
    setfenv(chunk, getgenv())
    chunk()
end)

-- 15. menu lib (uses the lib you supplied)
local menu = lib.Menu.new("Da Hood Undefeated")
local aimTab   = menu:AddTab("Aim")
local visTab   = menu:AddTab("Visual")
local miscTab  = menu:AddTab("Misc")
local aiTab    = menu:AddTab("AI")
local luaTab   = menu:AddTab("Lua")

aimTab:AddToggle("Silent Aim", false, function(v)
    -- already hooked in __namecall, nothing else needed
end)
aimTab:AddToggle("Triggerbot", false, function(v) triggerbot = v end)
visTab:AddToggle("ESP", true, function(v)
    for _,d in pairs(espCache) do d.Visible = v end
end)
miscTab:AddButton("Toggle Fly", toggleFly)
miscTab:AddButton("Toggle Noclip", toggleNoclip)
aiTab:AddButton("Open AI Chat", function() aiGui.Enabled = not aiGui.Enabled end)
luaTab:AddButton("Open Lua VM", function() vmGui.Enabled = not vmGui.Enabled end)

-- 16. panic key
uis.InputBegan:Connect(function(k)
    if k.KeyCode == Enum.KeyCode.P then
        -- kill every flag in 0.05 s
        for _,c in ipairs(cg:GetChildren()) do c:Destroy() end
        for _,c in ipairs(lp.PlayerGui:GetChildren()) do
            if c.Name:find("desync") or c.Name:find("esp") or c.Name:find("ai") or c.Name:find("vm") then
                c:Destroy()
            end
        end
        hookmetamethod(game,"__namecall",oldNamecall) -- restore
        hookfunction(getrawmetatable(getrenv().script).Play,oldPlay)
        game:GetService("TeleportService"):Teleport(game.PlaceId,lp) -- optional server-hop
    end
end)

-- 17. updater banner
sg:SetCore("SendNotification",{Title = "Da Hood Undefeated",Text = "400+ features injected – P = panic",Duration = 5})

end) -- end pcall
if not suc then
    warn("Loader crashed: "..tostring(err))
    game:GetService("TeleportService"):Teleport(game.PlaceId,game:GetService("Players").LocalPlayer)
end
